{% extends "base.html" %}

{% block title %}Reset Access Key - QueryVault{% endblock %}

{% block content %}
<section class="connection-box" style="max-width: 450px; margin: 6rem auto;" data-aos="zoom-in">
    <h2 class="section-title" style="font-size: 1.8rem; margin-bottom: 2rem;">Recover Identity</h2>
    
    <p style="color: var(--text-secondary); text-align: center; margin-bottom: 2rem;">
        Enter your registered neural identity (email) to receive an emergency access reset link.
    </p>

    <form id="forgot-form">
        <div class="input-group">
            <label for="email">Neural Identity (Email)</label>
            <input type="email" id="email" placeholder="agent@queryvault.io" required>
        </div>

        <div style="margin-top: 2rem;">
            <button type="submit" class="btn btn-primary" style="width: 100%;">
                <span class="btn-icon">ðŸ“¡</span> Broadcast Reset Signal
            </button>
        </div>
    </form>

    <div id="status-msg" class="message-container info hidden" style="margin-top: 1.5rem;"></div>

    <p style="margin-top: 2rem; text-align: center; color: var(--text-secondary); font-size: 0.9rem;">
        Remembered your key? <a href="/login" style="color: var(--primary-blue); font-weight: bold; text-decoration: none;">Return to Login</a>
    </p>
</section>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('forgot-form').onsubmit = async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const msg = document.getElementById('status-msg');
        
        try {
            const resp = await fetch('/auth/forgot-password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email })
            });
            const data = await resp.json();
            msg.textContent = data.message || 'Reset signal broadcasted. Please check your secure inbox.';
            msg.classList.remove('hidden');
            msg.className = "message-container info";
        } catch (err) {
            msg.textContent = 'Neural interference detected. Failed to broadcast signal.';
            msg.classList.remove('hidden');
            msg.className = "message-container error";
        }
    };
</script>
{% endblock %}
